
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Custom Data &mdash; KairosDB 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap-none.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/kairosdb.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="KairosDB 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="Kairos Development" href="index.html" />
    <link rel="next" title="Editing Kairos with IntelliJ" href="IntelliJSetup.html" />
    <link rel="prev" title="Plugins" href="Plugins.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>




 <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand logo" href="http://kairosdb.github.io/"><img alt="Brand" src="../_static/kairosdb.png"></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
			<li><a href="http://kairosdb.github.io/">Overview</a></li>
            <li class="active"><a href="../index.html">Documentation</a></li>
            <li ><a href="https://groups.google.com/forum/?hl=fr#!forum/kairosdb-group" target="_blank">Community</a></li>
            <li><a href="https://github.com/kairosdb/kairosdb">Github</a></li>
			
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
          </ul>
		  
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav"><h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PushingData.html">Pushing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QueryingData.html">Querying data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ImportExport.html">Importing and Exporting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WebUI.html">Web UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Statistics.html">KairosDB Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../KairosClient.html">Kairos DB Java Client Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CassandraSchema.html">Cassandra Schema</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Kairos Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Plugins.html">Plugins</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Custom Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#steps-for-creating-custom-data-type">Steps for creating custom data type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-for-creating-custom-types">Example for creating custom types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="IntelliJSetup.html">Editing Kairos with IntelliJ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../restapi/index.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../telnetapi/index.html">Telnet API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Graphite.html">Graphite Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../IssueTracking.html">Bug Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../External.html">External links</a></li>
</ul>

<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="custom-data">
<h1>Custom Data<a class="headerlink" href="#custom-data" title="Permalink to this headline">¶</a></h1>
<p>KairosDB provides a means for storing and aggregating custom data types.  By default KairosDB supports long, double and string values.</p>
<div class="section" id="steps-for-creating-custom-data-type">
<h2>Steps for creating custom data type<a class="headerlink" href="#steps-for-creating-custom-data-type" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Create a <a class="reference external" href="Plugins.html">plugin</a>.</li>
<li>Create a DataPointFactory implementation.</li>
<li>Create a DataPoint implementation.</li>
<li>Bind your DataPointFactory in your plugin module.</li>
<li>Register custom type in the properties file.</li>
</ol>
<p>Look at StringDataPointFactory.java and StringDataPoint.java for examples of how to implement.</p>
</div>
<div class="section" id="example-for-creating-custom-types">
<h2>Example for creating custom types<a class="headerlink" href="#example-for-creating-custom-types" title="Permalink to this headline">¶</a></h2>
<p>For this example we want a custom type for complex numbers that have a real and imaginary part.  Following is the code for the DataPoint and DataPointFactory implementations:</p>
<p>ComplexDataPoint</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">kairosdb</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">datapoints</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.json.JSONException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONWriter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.DataOutput</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> Used to show how to create a custom data type</span>
<span class="cm"> Created by bhawkins on 6/27/14.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComplexDataPoint</span> <span class="kd">extends</span> <span class="n">DataPointHelper</span>
<span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">API_TYPE</span> <span class="o">=</span> <span class="s">&quot;complex&quot;</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">double</span> <span class="n">m_real</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">double</span> <span class="n">m_imaginary</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">ComplexDataPoint</span><span class="o">(</span><span class="kt">long</span> <span class="n">timestamp</span><span class="o">,</span> <span class="kt">double</span> <span class="n">real</span><span class="o">,</span> <span class="kt">double</span> <span class="n">imaginary</span><span class="o">)</span>
        <span class="o">{</span>
                <span class="kd">super</span><span class="o">(</span><span class="n">timestamp</span><span class="o">);</span>
                <span class="n">m_real</span> <span class="o">=</span> <span class="n">real</span><span class="o">;</span>
                <span class="n">m_imaginary</span> <span class="o">=</span> <span class="n">imaginary</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeValueToBuffer</span><span class="o">(</span><span class="n">DataOutput</span> <span class="n">buffer</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span>
        <span class="o">{</span>
                <span class="n">buffer</span><span class="o">.</span><span class="na">writeDouble</span><span class="o">(</span><span class="n">m_real</span><span class="o">);</span>
                <span class="n">buffer</span><span class="o">.</span><span class="na">writeDouble</span><span class="o">(</span><span class="n">m_imaginary</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeValueToJson</span><span class="o">(</span><span class="n">JSONWriter</span> <span class="n">writer</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JSONException</span>
        <span class="o">{</span>
                <span class="n">writer</span><span class="o">.</span><span class="na">object</span><span class="o">();</span>

                <span class="n">writer</span><span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">&quot;real&quot;</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">m_real</span><span class="o">);</span>
                <span class="n">writer</span><span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">&quot;imaginary&quot;</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">m_imaginary</span><span class="o">);</span>

                <span class="n">writer</span><span class="o">.</span><span class="na">endObject</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getApiDataType</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="n">API_TYPE</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDataStoreDataType</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="n">ComplexDataPointFactory</span><span class="o">.</span><span class="na">DST_COMPLEX</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isLong</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getLongValue</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDouble</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getDoubleValue</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>ComplexDataPointFactory</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">kairosdb</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">datapoints</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.gson.JsonElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.gson.JsonObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.kairosdb.core.DataPoint</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.DataInput</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> Used to show how to create a custom data type</span>
<span class="cm"> Created by bhawkins on 6/30/14.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComplexDataPointFactory</span> <span class="kd">implements</span> <span class="n">DataPointFactory</span>
<span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DST_COMPLEX</span> <span class="o">=</span> <span class="s">&quot;kairos_complex&quot;</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GROUP_TYPE</span> <span class="o">=</span> <span class="s">&quot;complex&quot;</span><span class="o">;</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDataStoreType</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="n">DST_COMPLEX</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getGroupType</span><span class="o">()</span>
        <span class="o">{</span>
                <span class="k">return</span> <span class="n">GROUP_TYPE</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">DataPoint</span> <span class="nf">getDataPoint</span><span class="o">(</span><span class="kt">long</span> <span class="n">timestamp</span><span class="o">,</span> <span class="n">JsonElement</span> <span class="n">json</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span>
        <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">isJsonObject</span><span class="o">())</span>
                <span class="o">{</span>
                        <span class="n">JsonObject</span> <span class="n">object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsJsonObject</span><span class="o">();</span>
                        <span class="kt">double</span> <span class="n">real</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;real&quot;</span><span class="o">).</span><span class="na">getAsDouble</span><span class="o">();</span>
                        <span class="kt">double</span> <span class="n">imaginary</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;imaginary&quot;</span><span class="o">).</span><span class="na">getAsDouble</span><span class="o">();</span>

                        <span class="k">return</span> <span class="k">new</span> <span class="nf">ComplexDataPoint</span><span class="o">(</span><span class="n">timestamp</span><span class="o">,</span> <span class="n">real</span><span class="o">,</span> <span class="n">imaginary</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">else</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">(</span><span class="s">&quot;JSON object is not a valid complex data point&quot;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">DataPoint</span> <span class="nf">getDataPoint</span><span class="o">(</span><span class="kt">long</span> <span class="n">timestamp</span><span class="o">,</span> <span class="n">DataInput</span> <span class="n">buffer</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span>
        <span class="o">{</span>
                <span class="kt">double</span> <span class="n">real</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">readDouble</span><span class="o">();</span>
                <span class="kt">double</span> <span class="n">imaginary</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">readDouble</span><span class="o">();</span>

                <span class="k">return</span> <span class="k">new</span> <span class="nf">ComplexDataPoint</span><span class="o">(</span><span class="n">timestamp</span><span class="o">,</span> <span class="n">real</span><span class="o">,</span> <span class="n">imaginary</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Inside our plugin module we&#8217;ll need to bind the ComplexDataPointFactory like so:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">bind</span><span class="o">(</span><span class="n">ComplexDataPointFactory</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">in</span><span class="o">(</span><span class="n">Singleton</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</pre></div>
</div>
<p>Inside our plugin properties file we&#8217;ll need to register our api type:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">kairosdb</span><span class="o">.</span><span class="na">datapoints</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">complex</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="na">kairosdb</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">datapoints</span><span class="o">.</span><span class="na">ComplexDataPointFactory</span>
</pre></div>
</div>
<p>So why are the above two steps separate and required?  The first step binds our factory into guice and registers the datastore type of &#8216;kairos_complex&#8217;.  The second step registers the api type.  Lets say down the road we change how we want to store the complex type.  Without this separation the only way to change is by exporting all the data in importing it using the new method.  With this separation I can register a new factory that defines the datastore type as &#8216;kairos_complex2&#8217; and bind it to the &#8216;complex&#8217; api type.  New data will now be stored in the new format and yet the system will still be able to read the old data.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, KairosDB Team.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>